<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Recorder - AudioForge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            bg: '#05050a',
                            panel: 'rgba(21, 21, 30, 0.6)',
                            primary: '#06b6d4', // Cyan
                            secondary: '#d946ef', // Fuchsia
                            text: '#e2e8f0',
                            muted: '#64748b'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    boxShadow: {
                        'neon': '0 0 10px rgba(6, 182, 212, 0.5)',
                        'neon-sec': '0 0 10px rgba(217, 70, 239, 0.5)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #05050a 100%);
            color: white;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .visualizer-bar {
            transition: height 0.1s ease;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            100% {
                transform: scale(1.3);
                opacity: 0;
            }
        }

        .recording-pulse::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 2px solid #ef4444;
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col font-sans overflow-hidden">

    <!-- Header -->
    <header class="h-16 glass z-50 flex items-center justify-between px-6 border-b border-white/5 shrink-0">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded bg-gradient-to-br from-cyber-primary to-cyber-secondary flex items-center justify-center">
                <i class="fas fa-microphone text-white text-sm"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight">AudioForge <span
                    class="text-cyber-primary font-light">Recorder</span></h1>
        </div>
        <a href="../index.html" class="text-xs text-cyber-muted hover:text-white transition-colors">
            <i class="fas fa-arrow-left mr-1"></i> Back to Tools
        </a>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col items-center justify-center p-6 relative">

        <!-- Recorder Interface -->
        <div
            class="glass w-full max-w-2xl rounded-2xl p-8 flex flex-col items-center gap-8 relative overflow-hidden transition-all duration-300 shadow-2xl">

            <!-- Status Text -->
            <div class="text-center space-y-2">
                <div id="status-badge"
                    class="inline-block px-3 py-1 rounded-full bg-white/5 text-xs text-cyber-muted uppercase tracking-widest border border-white/10">
                    Ready to Record
                </div>
                <div id="timer"
                    class="text-5xl md:text-7xl font-mono font-bold text-white tabular-nums tracking-wider opacity-50 transition-opacity">
                    00:00.00
                </div>
            </div>

            <!-- Visualization -->
            <div class="w-full h-32 flex items-center justify-center gap-1 opacity-50" id="visualizer">
                <!-- Bars generated by JS -->
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-6 z-10">
                <button id="btn-record"
                    class="group relative w-20 h-20 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center transition-all shadow-[0_0_20px_rgba(239,68,68,0.4)] hover:shadow-[0_0_30px_rgba(239,68,68,0.6)]">
                    <div class="w-8 h-8 rounded bg-white transition-all group-hover:rounded-sm"></div>
                </button>
            </div>

            <!-- Settings / Output -->
            <div class="w-full pt-6 border-t border-white/5 flex flex-col gap-4 hidden" id="output-panel">
                <div class="flex items-center justify-between bg-black/30 p-4 rounded-lg border border-white/5">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-full bg-cyber-primary/20 flex items-center justify-center text-cyber-primary">
                            <i class="fas fa-music"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-white">Recording_001.webm</p>
                            <p class="text-xs text-cyber-muted" id="file-size">0.0 MB</p>
                        </div>
                    </div>
                    <audio id="audio-preview" controls
                        class="h-8 max-w-[200px] opacity-70 hover:opacity-100 transition-opacity"></audio>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button
                        class="glass py-3 rounded-lg text-sm hover:bg-white/5 transition-colors text-cyber-muted hover:text-white"
                        onclick="resetRecorder()">
                        <i class="fas fa-trash-alt mr-2"></i> Discard
                    </button>
                    <button id="btn-download"
                        class="bg-cyber-primary text-black py-3 rounded-lg text-sm font-bold hover:bg-cyan-400 transition-colors shadow-neon">
                        <i class="fas fa-download mr-2"></i> Download
                    </button>
                </div>
            </div>

        </div>

    </main>

    <script>
        // DOM
        const btnRecord = document.getElementById('btn-record');
        const timerDisplay = document.getElementById('timer');
        const statusBadge = document.getElementById('status-badge');
        const visualizer = document.getElementById('visualizer');
        const outputPanel = document.getElementById('output-panel');
        const audioPreview = document.getElementById('audio-preview');
        const btnDownload = document.getElementById('btn-download');
        const fileSizeEl = document.getElementById('file-size');

        // State
        let mediaRecorder;
        let audioChunks = [];
        let startTime;
        let timerInterval;
        let isRecording = false;
        let audioContext;
        let analyser;
        let dataArray;
        let visualizerFrame;

        // Init Visualizer Bars
        const BAR_COUNT = 32;
        for (let i = 0; i < BAR_COUNT; i++) {
            const bar = document.createElement('div');
            bar.className = 'w-1.5 md:w-2 bg-cyber-primary rounded-full transition-all duration-75 ease-out';
            bar.style.height = '4px';
            bar.style.opacity = '0.2';
            visualizer.appendChild(bar);
        }
        const bars = Array.from(visualizer.children);

        // Events
        btnRecord.addEventListener('click', toggleRecording);

        async function toggleRecording() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // Audio Context only for visualizer
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 64;
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                dataArray = new Uint8Array(analyser.frequencyBinCount);

                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPreview.src = audioUrl;

                    const sizeMB = (audioBlob.size / (1024 * 1024)).toFixed(2);
                    fileSizeEl.textContent = `${sizeMB} MB`;

                    btnDownload.onclick = () => {
                        const a = document.createElement('a');
                        a.href = audioUrl;
                        a.download = `recording_${new Date().getTime()}.webm`;
                        a.click();
                    };

                    outputPanel.classList.remove('hidden');
                    btnRecord.classList.add('hidden'); // Hide big red button when reviewing

                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                isRecording = true;
                startTime = Date.now();

                // UI Updates
                statusBadge.textContent = "Recording...";
                statusBadge.classList.replace('text-cyber-muted', 'text-red-500');
                statusBadge.classList.add('animate-pulse');
                timerDisplay.classList.remove('opacity-50');
                timerDisplay.classList.add('text-white');
                btnRecord.classList.add('recording-pulse');
                btnRecord.innerHTML = '<i class="fas fa-stop text-2xl text-black"></i>'; // Stop icon
                outputPanel.classList.add('hidden');

                startTimer();
                animateVisualizer();

            } catch (err) {
                console.error("Error accessing microphone:", err);
                alert("Could not access microphone. Please ensure permissions are granted.");
            }
        }

        function stopRecording() {
            mediaRecorder.stop();
            isRecording = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(visualizerFrame);

            // UI Reset specific to stopped state
            statusBadge.textContent = "Recording Finished";
            statusBadge.classList.remove('animate-pulse');
            btnRecord.classList.remove('recording-pulse');
            bars.forEach(bar => bar.style.height = '4px');
        }

        function resetRecorder() {
            outputPanel.classList.add('hidden');
            btnRecord.classList.remove('hidden');
            btnRecord.innerHTML = '<div class="w-8 h-8 rounded bg-white transition-all group-hover:rounded-sm"></div>';
            statusBadge.textContent = "Ready to Record";
            statusBadge.classList.replace('text-red-500', 'text-cyber-muted');
            timerDisplay.textContent = "00:00.00";
            timerDisplay.classList.add('opacity-50');
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const date = new Date(elapsed);
                const mm = String(date.getMinutes()).padStart(2, '0');
                const ss = String(date.getSeconds()).padStart(2, '0');
                const ms = String(Math.floor(date.getMilliseconds() / 10)).padStart(2, '0');
                timerDisplay.textContent = `${mm}:${ss}.${ms}`;
            }, 10);
        }

        function animateVisualizer() {
            if (!isRecording) return;
            visualizerFrame = requestAnimationFrame(animateVisualizer);
            analyser.getByteFrequencyData(dataArray);

            // Map frequency data to bars (simple mirrored visualization)
            for (let i = 0; i < BAR_COUNT; i++) {
                // Use the lower half of frequency data where speech usually is
                const index = Math.floor(i * (dataArray.length / 2) / BAR_COUNT);
                const value = dataArray[index];
                const height = Math.max(4, (value / 255) * 100); // Max 100px height
                bars[i].style.height = `${height}px`;
                bars[i].style.opacity = Math.max(0.2, value / 255);
            }
        }
    </script>
</body>

</html>