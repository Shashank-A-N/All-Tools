<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitStream Pro - Batch Video Splitter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- JSZip for Batch Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Animations */
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }

        /* Utility */
        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
</head>

<body
    class="bg-[#0f0f12] text-slate-100 font-sans overflow-hidden h-screen flex flex-col selection:bg-cyan-500/30 selection:text-cyan-100">

    <!-- Hidden Processing Video Element -->
    <video id="processing-video" class="hidden" crossorigin="anonymous" muted playsinline></video>

    <!-- Header -->
    <header
        class="flex flex-col sm:flex-row items-center justify-between px-6 py-3 bg-[#131316] border-b border-white/5 z-20 gap-4 flex-shrink-0">
        <div class="flex items-center gap-3 w-full sm:w-auto justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-gradient-to-tr from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-900/20">
                    <i data-lucide="scissors" class="w-5 h-5 text-white"></i>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-lg font-bold tracking-tight text-white flex items-center gap-2">
                        SplitStream <span
                            class="px-1.5 py-0.5 rounded text-[10px] bg-white/10 text-cyan-400 font-mono border border-white/5">PRO</span>
                    </h1>
                    <p class="hidden sm:block text-[11px] text-slate-500">Local Batch Video Processor</p>
                </div>
            </div>
            <!-- Mobile Status -->
            <div class="sm:hidden" id="mobile-status-container"></div>
        </div>

        <!-- Desktop Status -->
        <div class="hidden sm:flex items-center gap-6" id="header-status">
            <div
                class="flex items-center gap-2 text-xs text-emerald-500/80 bg-emerald-950/20 px-3 py-1.5 rounded-full border border-emerald-500/10">
                <i data-lucide="check-circle-2" class="w-3 h-3"></i> Engine Ready
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-col md:flex-row flex-1 overflow-hidden relative">

        <!-- Sidebar (Left Screen) -->
        <div
            class="w-full md:w-80 h-[35vh] md:h-full flex flex-col bg-[#111113] border-b md:border-b-0 md:border-r border-white/5 flex-shrink-0 z-10">
            <!-- Drop Zone -->
            <div class="p-4 border-b border-white/5 flex-shrink-0">
                <label
                    class="flex flex-col items-center justify-center w-full h-20 sm:h-24 border border-dashed border-white/10 rounded-xl hover:border-cyan-500/50 hover:bg-white/[0.02] transition-all cursor-pointer group relative overflow-hidden">
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                    </div>
                    <input type="file" id="file-input" multiple accept="video/*" class="hidden">
                    <div class="flex flex-col items-center gap-2 relative z-10">
                        <div class="p-2 bg-white/5 rounded-full group-hover:bg-cyan-500/20 transition-colors">
                            <i data-lucide="upload" class="w-4 h-4 text-slate-400 group-hover:text-cyan-400"></i>
                        </div>
                        <span class="text-xs text-slate-500 group-hover:text-slate-300">Import Videos</span>
                    </div>
                </label>
            </div>

            <!-- File List (Scrollable) -->
            <div id="file-list" class="flex-1 overflow-y-auto p-2 space-y-2">
                <!-- Empty State -->
                <div class="flex flex-col items-center justify-center h-full text-slate-600 py-8">
                    <i data-lucide="film" class="w-10 h-10 mb-3 opacity-10"></i>
                    <span class="text-xs font-medium">Queue is empty</span>
                </div>
            </div>

            <!-- Sidebar Actions -->
            <div class="p-3 sm:p-4 border-t border-white/5 bg-[#111113] space-y-2 flex-shrink-0">
                <button id="btn-process-queue" disabled
                    class="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:from-slate-800 disabled:to-slate-800 disabled:text-slate-500 text-white rounded-xl font-bold shadow-lg shadow-blue-900/20 transition-all flex items-center justify-center gap-2 text-sm disabled:cursor-not-allowed disabled:shadow-none">
                    <i data-lucide="zap" class="w-4 h-4 fill-white/20"></i>
                    <span id="btn-process-text">Start Batch</span>
                </button>

                <!-- New Global Download Button -->
                <button id="btn-global-download"
                    class="hidden w-full py-2.5 bg-emerald-600/20 hover:bg-emerald-600/30 text-emerald-400 hover:text-emerald-300 border border-emerald-500/20 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-xs">
                    <i data-lucide="package" class="w-4 h-4"></i>
                    Download All Project Outputs (ZIP)
                </button>

                <div class="flex gap-2">
                    <button id="btn-export-json"
                        class="flex-1 py-2 text-xs text-slate-400 bg-white/5 hover:bg-white/10 hover:text-white rounded-lg transition-colors border border-white/5"
                        title="Save current regions configuration">
                        <i data-lucide="save" class="w-3 h-3 inline mr-1"></i> Save Project
                    </button>
                    <button id="btn-cancel"
                        class="hidden flex-1 py-2 text-xs text-red-400 hover:text-red-300 hover:bg-red-900/10 rounded-lg transition-colors border border-red-900/20">
                        Abort
                    </button>
                </div>
            </div>
        </div>

        <!-- Editor Area (Right Screen) -->
        <div id="editor-container" class="flex-1 flex flex-col bg-[#0f0f12] relative overflow-hidden h-full">
            <!-- Empty State -->
            <div id="editor-empty"
                class="flex-1 flex flex-col items-center justify-center text-slate-600 space-y-6 p-4 text-center">
                <div
                    class="w-24 h-24 bg-[#151518] rounded-3xl border border-white/5 flex items-center justify-center shadow-2xl">
                    <i data-lucide="monitor" class="w-10 h-10 text-slate-700"></i>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-slate-300">No Video Selected</h3>
                    <p class="text-sm text-slate-500 mt-1">Select a video from the sidebar to open the editor</p>
                </div>
            </div>

            <!-- Active Editor (Scrollable Container) -->
            <div id="editor-content" class="hidden flex-1 flex-col h-full overflow-y-auto animate-fade-in relative">

                <!-- Video Player Section -->
                <div
                    class="flex-shrink-0 flex flex-col items-center justify-center p-4 bg-[#0a0a0c] relative group overflow-hidden min-h-[40vh]">

                    <!-- Video Wrapper -->
                    <div class="relative w-full h-full flex items-center justify-center max-w-5xl mx-auto">
                        <div class="relative shadow-2xl shadow-black/50 rounded-lg overflow-hidden border border-white/5"
                            style="max-height: 100%; max-width: 100%;">
                            <video id="main-video"
                                class="block w-auto h-auto max-w-full max-h-[60vh] object-contain bg-black cursor-pointer"></video>

                            <!-- Overlay Play Button -->
                            <div id="overlay-play"
                                class="absolute inset-0 flex items-center justify-center bg-black/20 pointer-events-none transition-opacity duration-200">
                                <div
                                    class="w-16 h-16 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/20 shadow-xl">
                                    <i data-lucide="play" class="w-6 h-6 fill-white text-white ml-1"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Controls -->
                    <div
                        class="absolute bottom-4 flex items-center gap-4 px-6 py-2.5 bg-[#151518]/90 backdrop-blur-md border border-white/10 rounded-full shadow-xl opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 z-30">
                        <button id="btn-skip-back" class="text-slate-400 hover:text-white"><i data-lucide="skip-back"
                                class="w-4 h-4"></i></button>
                        <button id="btn-play-pause"
                            class="text-white hover:text-cyan-400 transform hover:scale-110 transition-all">
                            <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                        </button>
                        <button id="btn-skip-forward" class="text-slate-400 hover:text-white"><i
                                data-lucide="skip-forward" class="w-4 h-4"></i></button>

                        <div class="w-px h-4 bg-white/20 mx-1"></div>

                        <div class="flex items-center gap-2">
                            <button id="btn-mute-toggle" class="text-slate-400 hover:text-white">
                                <i data-lucide="volume-2" class="w-4 h-4"></i>
                            </button>
                            <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1"
                                class="w-16 h-1 bg-white/20 rounded-lg cursor-pointer">
                        </div>

                        <div class="w-px h-4 bg-white/20 mx-1"></div>

                        <span class="text-[10px] font-mono text-slate-400">
                            <span id="current-time-display">00:00</span> <span class="text-slate-600">/</span> <span
                                id="total-duration-display">00:00</span>
                        </span>
                    </div>
                </div>

                <!-- Controls Panel -->
                <div
                    class="flex-shrink-0 bg-[#111113] border-t border-white/5 p-4 sm:p-6 flex flex-col gap-6 z-40 shadow-[0_-10px_40px_rgba(0,0,0,0.3)]">

                    <!-- Timeline Slider -->
                    <div class="w-full flex-shrink-0 space-y-2">
                        <div
                            class="flex justify-between text-[10px] text-slate-500 font-medium tracking-wide uppercase">
                            <span>Timeline</span>
                            <span>Duration: <span id="active-duration-display" class="text-cyan-400">00:00</span></span>
                        </div>

                        <!-- Range Slider Container -->
                        <div id="timeline-container"
                            class="relative h-12 flex items-center group select-none cursor-pointer">
                            <!-- Filmstrip Background -->
                            <div class="absolute inset-0 bg-[#0a0a0c] border border-white/10 rounded-lg overflow-hidden opacity-50"
                                id="filmstrip-bg"></div>

                            <!-- Highlights Container for Multi-Trim -->
                            <div id="highlights-layer" class="absolute inset-0 pointer-events-none">
                                <!-- Highlights injected via JS -->
                            </div>

                            <!-- Scrubber Head -->
                            <div id="scrubber-head"
                                class="absolute top-0 bottom-0 w-0.5 bg-white z-20 shadow-[0_0_10px_rgba(255,255,255,0.8)] pointer-events-none transition-all duration-75 left-0">
                                <div class="absolute -top-1.5 -left-1.5 w-3.5 h-3.5 bg-white rounded-full shadow-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
                        <!-- Mode & Times -->
                        <div class="lg:col-span-8 flex flex-col gap-4">
                            <!-- Toggle Mode -->
                            <div class="flex items-center gap-4">
                                <div class="flex bg-black/20 p-1 rounded-lg border border-white/5">
                                    <button id="btn-mode-trim"
                                        class="px-4 py-1.5 text-xs font-medium rounded-md transition-all bg-[#1f1f23] text-cyan-400 border border-white/10 shadow-sm">Trim
                                        Mode</button>
                                    <button id="btn-mode-segment"
                                        class="px-4 py-1.5 text-xs font-medium rounded-md transition-all text-slate-500 hover:text-slate-300">Split
                                        Parts</button>
                                </div>
                                <div class="h-px flex-1 bg-white/5"></div>
                            </div>

                            <!-- Inputs Container -->
                            <div id="inputs-container" class="flex flex-col gap-3">
                                <!-- Dynamic input rows injected here via JS -->
                            </div>
                        </div>

                        <!-- Export Settings -->
                        <div
                            class="lg:col-span-4 bg-[#161619] rounded-xl border border-white/5 p-4 flex flex-col gap-4">
                            <h4
                                class="text-[10px] text-slate-400 font-bold uppercase tracking-wider flex items-center gap-2">
                                <i data-lucide="settings-2" class="w-3 h-3"></i> Export Settings
                            </h4>
                            <div class="space-y-3">
                                <div class="flex flex-col gap-1.5">
                                    <label class="text-[10px] text-slate-500">Quality (Bitrate)</label>
                                    <select id="config-quality"
                                        class="bg-black/30 border border-white/10 text-xs text-slate-300 rounded px-2 py-2 outline-none focus:border-cyan-500/50">
                                        <option value="high">High (1080p target)</option>
                                        <option value="medium">Medium (720p target)</option>
                                        <option value="low">Low (Space Saver)</option>
                                    </select>
                                </div>
                                <div class="flex flex-col gap-1.5">
                                    <label class="text-[10px] text-slate-500">Processing Speed</label>
                                    <select id="config-speed"
                                        class="bg-black/30 border border-white/10 text-xs text-slate-300 rounded px-2 py-2 outline-none focus:border-cyan-500/50">
                                        <option value="1">1.0x (Slow, Best)</option>
                                        <option value="2">2.0x (Balanced)</option>
                                        <option value="4">4.0x (Fast, Low Quality)</option>
                                    </select>
                                </div>
                                <div class="flex items-center justify-between pt-2 border-t border-white/5">
                                    <label class="text-xs text-slate-400">Mute Audio</label>
                                    <button id="btn-toggle-mute"
                                        class="w-10 h-5 rounded-full relative transition-colors bg-white/10">
                                        <div id="mute-knob"
                                            class="absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-all">
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generated Outputs List -->
                <div id="outputs-container" class="hidden flex-shrink-0 bg-[#111113] border-t border-white/5 p-4 z-10">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                            <i data-lucide="check-circle-2" class="w-3 h-3 text-emerald-500"></i> Exported Files
                        </h3>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-slate-500">Download Options:</span>
                            <button id="btn-download-zip"
                                class="hidden text-[10px] bg-white/5 hover:bg-cyan-500/20 text-cyan-400 px-3 py-1.5 rounded-lg border border-cyan-500/20 flex items-center gap-1.5 transition-colors shadow-lg shadow-cyan-900/10">
                                <i data-lucide="archive" class="w-3 h-3"></i> Download as ZIP
                            </button>
                        </div>
                    </div>
                    <div id="outputs-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <!-- Output Items -->
                    </div>
                </div>
            </div>

            <!-- Global Toast/Log -->
            <div id="toast-container"
                class="absolute bottom-6 right-6 left-6 sm:left-auto max-w-sm pointer-events-none flex flex-col gap-2 items-end sm:items-end z-50">
            </div>

            <!-- Global FAB for Apply All -->
            <div id="fab-apply-all" class="absolute top-[3.75rem] right-4 z-50 sm:top-[4.5rem] sm:right-8 hidden">
                <button
                    class="group flex items-center gap-2 px-4 py-2 bg-[#1a1a1e]/80 backdrop-blur-md hover:bg-cyan-500/10 hover:border-cyan-500/30 text-xs font-medium text-slate-300 hover:text-cyan-400 rounded-full border border-white/10 shadow-lg transition-all">
                    <i data-lucide="fast-forward" class="w-3 h-3 group-hover:translate-x-0.5 transition-transform"></i>
                    <span class="hidden sm:inline">Apply to All</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Application Script -->
    <script>
        // --- State Management ---
        const state = {
            files: [],
            selectedFileId: null,
            isProcessing: false,
            processingStatus: 'Idle'
        };

        let abortController = null;
        const processingVideo = document.getElementById('processing-video');

        // --- DOM Elements ---
        const fileInput = document.getElementById('file-input');
        const fileListEl = document.getElementById('file-list');
        const editorEmptyEl = document.getElementById('editor-empty');
        const editorContentEl = document.getElementById('editor-content');
        const mainVideoEl = document.getElementById('main-video');
        const overlayPlayEl = document.getElementById('overlay-play');
        const btnProcess = document.getElementById('btn-process-queue');
        const btnCancel = document.getElementById('btn-cancel');
        const btnExportJson = document.getElementById('btn-export-json');
        const btnGlobalDownload = document.getElementById('btn-global-download');
        const toastContainer = document.getElementById('toast-container');

        // Editor Controls
        const timelineContainer = document.getElementById('timeline-container');
        const scrubberHead = document.getElementById('scrubber-head');
        const highlightsLayer = document.getElementById('highlights-layer');
        const inputsContainer = document.getElementById('inputs-container');
        const btnModeTrim = document.getElementById('btn-mode-trim');
        const btnModeSegment = document.getElementById('btn-mode-segment');
        const outputsContainer = document.getElementById('outputs-container');
        const outputsList = document.getElementById('outputs-list');

        // --- Helpers ---
        const generateId = () => Math.random().toString(36).substr(2, 9);

        const formatTime = (seconds) => {
            if (!seconds && seconds !== 0) return "00:00";
            const date = new Date(0);
            date.setSeconds(seconds);
            const hh = date.getUTCHours();
            const mm = date.getUTCMinutes();
            const ss = date.getUTCSeconds();
            const ms = Math.floor((seconds % 1) * 100);
            if (hh > 0) return `${hh.toString().padStart(2, '0')}:${mm.toString().padStart(2, '0')}:${ss.toString().padStart(2, '0')}`;
            return `${mm.toString().padStart(2, '0')}:${ss.toString().padStart(2, '0')}.${ms.toString().padStart(2, '0')}`;
        };

        const formatSize = (bytes) => {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        };

        const showToast = (message, type = 'info') => {
            const toast = document.createElement('div');
            const colorClass = type === 'error' ? 'bg-red-500' : (type === 'success' ? 'bg-emerald-500' : 'bg-cyan-500');
            toast.className = `bg-[#1a1a1e]/90 backdrop-blur-md text-[11px] text-slate-300 px-4 py-2.5 rounded-lg border border-white/10 shadow-xl shadow-black/50 animate-fade-in flex items-center gap-2 transform transition-all duration-300`;
            toast.innerHTML = `<div class="w-1.5 h-1.5 rounded-full ${colorClass}"></div> ${message}`;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(20px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };

        // --- File Handling ---
        fileInput.addEventListener('change', (e) => {
            if (!e.target.files.length) return;
            const newFiles = Array.from(e.target.files).map(file => ({
                id: generateId(),
                file,
                name: file.name,
                size: file.size,
                duration: 0,
                status: 'pending',
                progress: 0,
                outputs: [],
                config: {
                    mode: 'trim',
                    regions: [{ id: generateId(), start: 0, end: 0 }], // Multi-trim support
                    segmentTime: 30,
                    playbackRate: 2.0,
                    quality: 'high',
                    mute: false
                },
                objectUrl: URL.createObjectURL(file)
            }));

            state.files = [...state.files, ...newFiles];
            if (!state.selectedFileId && newFiles.length > 0) {
                selectFile(newFiles[0].id);
            } else {
                renderFileList();
                updateProcessButton();
            }
        });

        function selectFile(id) {
            state.selectedFileId = id;
            renderFileList();
            renderEditor();
        }

        function removeFile(id, e) {
            e.stopPropagation();
            const file = state.files.find(f => f.id === id);
            if (file) URL.revokeObjectURL(file.objectUrl);
            state.files = state.files.filter(f => f.id !== id);
            if (state.selectedFileId === id) {
                state.selectedFileId = state.files.length > 0 ? state.files[0].id : null;
            }
            renderFileList();
            renderEditor();
            updateProcessButton();
        }

        // --- State Updates ---

        function updateConfig(id, key, value) {
            const file = state.files.find(f => f.id === id);
            if (file) {
                file.config[key] = value;
                renderEditor();
                renderFileList();
            }
        }

        function updateRegion(fileId, regionId, key, value) {
            const file = state.files.find(f => f.id === fileId);
            if (file) {
                const region = file.config.regions.find(r => r.id === regionId);
                if (region) {
                    region[key] = value;
                    renderTimeline(file);
                    // No full re-render of inputs to maintain focus, handled in input listener
                }
            }
        }

        function addRegion(fileId) {
            const file = state.files.find(f => f.id === fileId);
            if (file) {
                file.config.regions.push({ id: generateId(), start: 0, end: file.duration || 10 });
                renderEditor();
            }
        }

        function removeRegion(fileId, regionId) {
            const file = state.files.find(f => f.id === fileId);
            if (file && file.config.regions.length > 1) {
                file.config.regions = file.config.regions.filter(r => r.id !== regionId);
                renderEditor();
            } else {
                showToast("Cannot remove the last region", "error");
            }
        }

        // --- Rendering ---
        function renderFileList() {
            fileListEl.innerHTML = '';
            if (state.files.length === 0) {
                fileListEl.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-slate-600 py-8">
                    <i data-lucide="film" class="w-10 h-10 mb-3 opacity-10"></i>
                    <span class="text-xs font-medium">Queue is empty</span>
                </div>`;
                return;
            }

            state.files.forEach(file => {
                const isActive = state.selectedFileId === file.id;
                const el = document.createElement('div');
                el.className = `relative p-3 rounded-xl border cursor-pointer transition-all group overflow-hidden ${isActive ? 'bg-white/[0.03] border-cyan-500/30 shadow-lg shadow-black/40' : 'bg-transparent border-transparent hover:bg-white/[0.02]'}`;
                el.onclick = () => selectFile(file.id);

                let statusColor = 'text-slate-600';
                if (file.status === 'processing') statusColor = 'text-cyan-400';
                if (file.status === 'done') statusColor = 'text-emerald-400';
                if (file.status === 'error') statusColor = 'text-red-400';

                const regionCount = file.config.regions.length;
                const modeText = file.config.mode === 'trim' ? (regionCount > 1 ? `${regionCount} Trims` : 'Trim Mode') : 'Split Parts';

                el.innerHTML = `
                    ${isActive ? '<div class="absolute left-0 top-0 bottom-0 w-1 bg-cyan-500 rounded-l-xl"></div>' : ''}
                    <div class="flex items-start justify-between mb-1 pl-2">
                        <div class="flex items-center gap-3 overflow-hidden w-full">
                            <i data-lucide="file-video" class="w-4 h-4 flex-shrink-0 ${isActive ? 'text-cyan-400' : 'text-slate-600'}"></i>
                            <div class="flex flex-col overflow-hidden w-full pr-2">
                                <span class="text-sm font-medium truncate text-slate-200">${file.name}</span>
                                <span class="text-[10px] text-slate-500 flex items-center gap-2">
                                    ${formatSize(file.size)}
                                    ${file.duration > 0 ? `<span class="w-1 h-1 rounded-full bg-slate-700"></span> ${formatTime(file.duration)}` : ''}
                                </span>
                            </div>
                        </div>
                        <button class="remove-btn opacity-0 group-hover:opacity-100 p-1.5 hover:bg-red-500/10 hover:text-red-400 text-slate-600 rounded-md transition-all">
                            <i data-lucide="trash-2" class="w-3 h-3"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-between text-[10px] pl-2 mt-2">
                        <div class="flex items-center gap-1.5 bg-white/5 px-2 py-0.5 rounded border border-white/5 text-slate-400">
                            <i data-lucide="${file.config.mode === 'trim' ? 'scissors' : 'layers'}" class="w-3 h-3"></i>
                            <span class="capitalize">${modeText}</span>
                        </div>
                        <span class="capitalize font-medium ${statusColor}">
                            ${file.status === 'processing' ? Math.round(file.progress) + '%' : file.status}
                        </span>
                    </div>
                    ${file.status === 'processing' ? `<div class="absolute bottom-0 left-0 h-0.5 bg-cyan-500/50 transition-all duration-300" style="width: ${file.progress}%"></div>` : ''}
                `;

                el.querySelector('.remove-btn').onclick = (e) => removeFile(file.id, e);
                fileListEl.appendChild(el);
            });
            lucide.createIcons();
        }

        function renderEditor() {
            const file = state.files.find(f => f.id === state.selectedFileId);

            if (!file) {
                editorEmptyEl.classList.remove('hidden');
                editorContentEl.classList.add('hidden');
                document.getElementById('fab-apply-all').classList.add('hidden');
                return;
            }

            editorEmptyEl.classList.add('hidden');
            editorContentEl.classList.remove('hidden');
            document.getElementById('fab-apply-all').classList.remove('hidden');
            document.getElementById('fab-apply-all').onclick = applySettingsToAll;

            const currentSrc = mainVideoEl.getAttribute('src');
            if (currentSrc !== file.objectUrl) {
                mainVideoEl.src = file.objectUrl;
                mainVideoEl.load();
                generateFilmstrip(file);
            }

            renderModeButtons(file);
            renderInputs(file);
            renderExportSettings(file);
            renderTimeline(file);
            renderOutputs(file);
        }

        function renderModeButtons(file) {
            const activeClass = "bg-[#1f1f23] text-cyan-400 border border-white/10 shadow-sm";
            const inactiveClass = "text-slate-500 hover:text-slate-300";

            if (file.config.mode === 'trim') {
                btnModeTrim.className = `px-4 py-1.5 text-xs font-medium rounded-md transition-all ${activeClass}`;
                btnModeSegment.className = `px-4 py-1.5 text-xs font-medium rounded-md transition-all ${inactiveClass}`;
            } else {
                btnModeTrim.className = `px-4 py-1.5 text-xs font-medium rounded-md transition-all ${inactiveClass}`;
                btnModeSegment.className = `px-4 py-1.5 text-xs font-medium rounded-md transition-all ${activeClass} text-purple-400`;
            }
        }

        function renderInputs(file) {
            inputsContainer.innerHTML = '';

            if (file.config.mode === 'trim') {
                // Render List of Regions
                file.config.regions.forEach((region, index) => {
                    const row = document.createElement('div');
                    row.className = "flex flex-wrap gap-4 items-end bg-black/20 p-3 rounded-lg border border-white/5 relative group";

                    // Start
                    const startWrap = document.createElement('div');
                    startWrap.className = "flex-1 min-w-[120px] flex flex-col gap-1.5";
                    startWrap.innerHTML = `
                        <div class="flex justify-between items-center"><label class="text-[10px] text-slate-500 uppercase font-bold">Start (Cut ${index + 1})</label></div>
                        <div class="flex items-center gap-2">
                            <input type="number" step="0.1" class="bg-transparent text-sm font-mono text-white outline-none w-full border-b border-white/10 focus:border-cyan-500 transition-colors pb-1" value="${region.start}">
                            <button class="text-[10px] bg-white/5 hover:bg-cyan-500 hover:text-white px-2 py-1 rounded text-cyan-400 transition-colors" title="Use current player time">Current</button>
                        </div>
                    `;
                    const startInput = startWrap.querySelector('input');
                    startInput.onchange = (e) => updateRegion(file.id, region.id, 'start', Number(e.target.value));
                    startWrap.querySelector('button').onclick = () => {
                        const t = Number(mainVideoEl.currentTime.toFixed(1));
                        startInput.value = t;
                        updateRegion(file.id, region.id, 'start', t);
                    };

                    // End
                    const endWrap = document.createElement('div');
                    endWrap.className = "flex-1 min-w-[120px] flex flex-col gap-1.5";
                    endWrap.innerHTML = `
                        <div class="flex justify-between items-center"><label class="text-[10px] text-slate-500 uppercase font-bold">End</label></div>
                        <div class="flex items-center gap-2">
                            <input type="number" step="0.1" class="bg-transparent text-sm font-mono text-white outline-none w-full border-b border-white/10 focus:border-cyan-500 transition-colors pb-1" value="${region.end}">
                            <button class="text-[10px] bg-white/5 hover:bg-cyan-500 hover:text-white px-2 py-1 rounded text-cyan-400 transition-colors" title="Use current player time">Current</button>
                        </div>
                    `;
                    const endInput = endWrap.querySelector('input');
                    endInput.onchange = (e) => updateRegion(file.id, region.id, 'end', Number(e.target.value));
                    endWrap.querySelector('button').onclick = () => {
                        const t = Number(mainVideoEl.currentTime.toFixed(1));
                        endInput.value = t;
                        updateRegion(file.id, region.id, 'end', t);
                    };

                    // Remove Btn
                    const removeBtn = document.createElement('button');
                    removeBtn.className = "p-2 text-slate-600 hover:text-red-400 hover:bg-red-500/10 rounded transition-colors";
                    removeBtn.innerHTML = `<i data-lucide="x" class="w-4 h-4"></i>`;
                    removeBtn.onclick = () => removeRegion(file.id, region.id);
                    if (file.config.regions.length === 1) removeBtn.disabled = true;

                    row.appendChild(startWrap);
                    row.appendChild(endWrap);
                    row.appendChild(removeBtn);
                    inputsContainer.appendChild(row);
                });

                // Add Region Button
                const addBtn = document.createElement('button');
                addBtn.className = "w-full py-2 border border-dashed border-white/20 rounded-lg text-xs text-slate-400 hover:text-cyan-400 hover:border-cyan-500/50 hover:bg-cyan-500/5 transition-all flex items-center justify-center gap-2";
                addBtn.innerHTML = `<i data-lucide="plus" class="w-3 h-3"></i> Add Another Cut`;
                addBtn.onclick = () => addRegion(file.id);
                inputsContainer.appendChild(addBtn);

            } else {
                // Segment Mode Inputs
                const segDiv = document.createElement('div');
                segDiv.className = "flex-1 bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-2";
                segDiv.innerHTML = `
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Segment Length (Sec)</label>
                    <input type="number" class="bg-transparent text-lg font-mono text-purple-400 outline-none w-full" value="${file.config.segmentTime}">
                `;
                segDiv.querySelector('input').onchange = (e) => updateConfig(file.id, 'segmentTime', Number(e.target.value));

                const estDiv = document.createElement('div');
                estDiv.className = "flex-1 bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-2";
                const estParts = Math.ceil(file.duration / (file.config.segmentTime || 1));
                estDiv.innerHTML = `
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Estimated Parts</label>
                    <div class="text-lg font-mono text-slate-300">${estParts} <span class="text-xs text-slate-600">files</span></div>
                `;

                inputsContainer.appendChild(segDiv);
                inputsContainer.appendChild(estDiv);
            }
            lucide.createIcons();
        }

        function renderExportSettings(file) {
            document.getElementById('config-quality').value = file.config.quality;
            document.getElementById('config-speed').value = file.config.playbackRate;

            const btnMute = document.getElementById('btn-toggle-mute');
            const knob = document.getElementById('mute-knob');

            if (file.config.mute) {
                btnMute.classList.remove('bg-white/10');
                btnMute.classList.add('bg-cyan-600');
                knob.classList.remove('left-1');
                knob.classList.add('left-6');
            } else {
                btnMute.classList.add('bg-white/10');
                btnMute.classList.remove('bg-cyan-600');
                knob.classList.add('left-1');
                knob.classList.remove('left-6');
            }
        }

        function renderTimeline(file) {
            const dur = file.duration || 1;
            document.getElementById('total-duration-display').innerText = formatTime(dur);

            highlightsLayer.innerHTML = '';

            if (file.config.mode === 'trim') {
                document.getElementById('active-duration-display').innerText = `${file.config.regions.length} cuts`;

                // Render all regions
                file.config.regions.forEach((region, i) => {
                    const startPct = (region.start / dur) * 100;
                    const widthPct = (((region.end || dur) - region.start) / dur) * 100;

                    const highlight = document.createElement('div');
                    highlight.className = "absolute h-full top-0 bg-cyan-500/30 border-x border-cyan-500/50 backdrop-contrast-125 pointer-events-none flex items-center justify-center group/hl";
                    highlight.style.left = `${startPct}%`;
                    highlight.style.width = `${Math.max(0, widthPct)}%`;

                    // Optional: Label number
                    if (widthPct > 5) {
                        highlight.innerHTML = `<span class="text-[8px] font-bold text-white opacity-50 group-hover/hl:opacity-100">${i + 1}</span>`;
                    }

                    highlightsLayer.appendChild(highlight);
                });

            } else {
                // Segment visualization (optional, simplified for now)
                document.getElementById('active-duration-display').innerText = formatTime(dur);
            }
        }

        function renderOutputs(file) {
            if (file.outputs.length > 0) {
                outputsContainer.classList.remove('hidden');
                outputsList.innerHTML = '';

                // ZIP Button Logic for Individual File
                const zipBtn = document.getElementById('btn-download-zip');
                if (file.outputs.length > 1) {
                    zipBtn.classList.remove('hidden');
                    zipBtn.onclick = () => downloadFileZip(file);
                } else {
                    zipBtn.classList.add('hidden');
                }

                file.outputs.forEach(out => {
                    const item = document.createElement('div');
                    item.className = "flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/5 hover:border-cyan-500/30 transition-colors group";
                    item.innerHTML = `
                         <div class="flex items-center gap-3 overflow-hidden">
                            <div class="w-8 h-8 rounded bg-black/40 flex items-center justify-center text-slate-600">
                                <i data-lucide="file-video" class="w-4 h-4"></i>
                            </div>
                            <span class="text-sm text-slate-300 truncate" title="${out.name}">${out.name}</span>
                         </div>
                         <a href="${out.url}" download="${out.name}" class="flex items-center gap-1.5 text-xs font-bold text-cyan-400 hover:text-cyan-300 bg-cyan-950/30 border border-cyan-500/20 px-3 py-1.5 rounded-md transition-all group-hover:bg-cyan-900/40">
                           <i data-lucide="download" class="w-3 h-3"></i> Save
                         </a>
                    `;
                    outputsList.appendChild(item);
                });
                lucide.createIcons();
            } else {
                outputsContainer.classList.add('hidden');
            }
        }

        async function downloadFileZip(file) {
            const zip = new JSZip();
            // Simplify structure for single file zip: just output files at root
            showToast("Compressing files...", "info");

            try {
                for (const out of file.outputs) {
                    const blob = await fetch(out.url).then(r => r.blob());
                    zip.file(out.name, blob);
                }

                const content = await zip.generateAsync({ type: "blob" });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `${file.name.split('.')[0]}_clips.zip`;
                link.click();
                URL.revokeObjectURL(link.href);
                showToast("Single file ZIP downloaded", "success");
            } catch (e) {
                console.error(e);
                showToast("Failed to zip file", "error");
            }
        }

        async function downloadGlobalZip() {
            const filesWithOutputs = state.files.filter(f => f.outputs.length > 0);
            if (filesWithOutputs.length === 0) return showToast("No processed files to download", "error");

            const zip = new JSZip();
            const root = zip.folder("SplitStream_Project");

            showToast("Compressing entire project...", "info");

            try {
                for (const file of filesWithOutputs) {
                    // Create folder for each video file
                    const fileFolder = root.folder(file.name.split('.')[0]);
                    for (const out of file.outputs) {
                        const blob = await fetch(out.url).then(r => r.blob());
                        fileFolder.file(out.name, blob);
                    }
                }

                const content = await zip.generateAsync({ type: "blob" });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `SplitStream_Global_Export.zip`;
                link.click();
                URL.revokeObjectURL(link.href);
                showToast("Global ZIP downloaded!", "success");
            } catch (e) {
                console.error(e);
                showToast("Failed to create Global ZIP", "error");
            }
        }

        // Global Download Button Listener
        btnGlobalDownload.onclick = downloadGlobalZip;

        function updateProcessButton() {
            const pending = state.files.filter(f => f.status === 'pending').length;
            const hasOutputs = state.files.some(f => f.outputs.length > 0);

            if (state.isProcessing) {
                btnProcess.disabled = true;
                btnProcess.innerHTML = `<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Processing...`;
                btnCancel.classList.remove('hidden');
            } else {
                btnProcess.disabled = pending === 0;
                btnProcess.innerHTML = `<i data-lucide="zap" class="w-4 h-4 fill-white/20"></i> Start Batch (${pending})`;
                btnCancel.classList.add('hidden');

                // Show Global Download if processing is done on some files
                if (hasOutputs) {
                    btnGlobalDownload.classList.remove('hidden');
                } else {
                    btnGlobalDownload.classList.add('hidden');
                }

                lucide.createIcons();
            }
        }

        function applySettingsToAll() {
            const active = state.files.find(f => f.id === state.selectedFileId);
            if (!active) return;
            state.files.forEach(f => {
                if (f.id !== active.id) {
                    // Clone simple config values
                    f.config.mode = active.config.mode;
                    f.config.segmentTime = active.config.segmentTime;
                    f.config.quality = active.config.quality;
                    f.config.playbackRate = active.config.playbackRate;
                    f.config.mute = active.config.mute;
                    f.config.regions = [{ id: generateId(), start: 0, end: f.duration || 0 }];
                }
            });
            renderEditor();
            showToast('Export settings applied (Time ranges reset for others)', 'success');
        }

        // --- Video Player Logic ---
        mainVideoEl.addEventListener('loadedmetadata', () => {
            const file = state.files.find(f => f.id === state.selectedFileId);
            if (file) {
                file.duration = mainVideoEl.duration;
                // If the first region is still 0-0, auto-set end to duration
                if (file.config.regions.length === 1 && file.config.regions[0].end === 0) {
                    file.config.regions[0].end = file.duration;
                }

                document.getElementById('total-duration-display').innerText = formatTime(file.duration);
                renderTimeline(file);
                renderFileList();
            }
        });

        mainVideoEl.addEventListener('timeupdate', () => {
            const file = state.files.find(f => f.id === state.selectedFileId);
            if (!file) return;

            const pct = (mainVideoEl.currentTime / mainVideoEl.duration) * 100;
            scrubberHead.style.left = `${pct}%`;
            document.getElementById('current-time-display').innerText = formatTime(mainVideoEl.currentTime);

            if (mainVideoEl.ended || mainVideoEl.paused) {
                overlayPlayEl.style.opacity = '1';
            } else {
                overlayPlayEl.style.opacity = '0';
            }
        });

        mainVideoEl.addEventListener('play', () => overlayPlayEl.style.opacity = '0');
        mainVideoEl.addEventListener('pause', () => overlayPlayEl.style.opacity = '1');

        timelineContainer.addEventListener('click', (e) => {
            const rect = timelineContainer.getBoundingClientRect();
            const pct = (e.clientX - rect.left) / rect.width;
            const time = pct * mainVideoEl.duration;
            mainVideoEl.currentTime = time;
        });

        document.getElementById('btn-play-pause').onclick = () => {
            if (mainVideoEl.paused) mainVideoEl.play(); else mainVideoEl.pause();
        };
        document.getElementById('btn-skip-back').onclick = () => mainVideoEl.currentTime -= 5;
        document.getElementById('btn-skip-forward').onclick = () => mainVideoEl.currentTime += 5;

        document.getElementById('btn-mute-toggle').onclick = () => {
            mainVideoEl.muted = !mainVideoEl.muted;
            document.getElementById('btn-mute-toggle').innerHTML = mainVideoEl.muted
                ? '<i data-lucide="volume-x" class="w-4 h-4"></i>'
                : '<i data-lucide="volume-2" class="w-4 h-4"></i>';
            lucide.createIcons();
        };
        document.getElementById('volume-slider').oninput = (e) => mainVideoEl.volume = e.target.value;

        btnModeTrim.onclick = () => updateConfig(state.selectedFileId, 'mode', 'trim');
        btnModeSegment.onclick = () => updateConfig(state.selectedFileId, 'mode', 'segment');

        document.getElementById('config-quality').onchange = (e) => updateConfig(state.selectedFileId, 'quality', e.target.value);
        document.getElementById('config-speed').onchange = (e) => updateConfig(state.selectedFileId, 'playbackRate', Number(e.target.value));
        document.getElementById('btn-toggle-mute').onclick = () => {
            const f = state.files.find(f => f.id === state.selectedFileId);
            if (f) updateConfig(f.id, 'mute', !f.config.mute);
        };

        // Export Project JSON logic
        btnExportJson.onclick = () => {
            if (state.files.length === 0) return showToast("Nothing to export", "error");

            // Cleanup cyclic/dom refs if any (file object not needed in JSON)
            const exportData = state.files.map(f => ({
                id: f.id,
                name: f.name,
                size: f.size,
                duration: f.duration,
                config: f.config
            }));

            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportData));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "splitstream_project.json");
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showToast("Project config exported!", "success");
        };

        function generateFilmstrip(file) {
            const container = document.getElementById('filmstrip-bg');
            container.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const div = document.createElement('div');
                div.className = "flex-1 h-full bg-white border-r border-white/5 last:border-0";
                div.style.opacity = (0.05 + Math.random() * 0.1).toString();
                container.appendChild(div);
            }
        }

        // --- Processing Logic ---
        btnProcess.onclick = async () => {
            state.isProcessing = true;
            updateProcessButton();
            abortController = new AbortController();

            const pending = state.files.filter(f => f.status === 'pending');

            for (const file of pending) {
                if (abortController.signal.aborted) break;
                file.status = 'processing';
                renderFileList();
                showToast(`Processing ${file.name}...`);

                try {
                    const outputs = await processSingleFile(file);
                    file.status = 'done';
                    file.progress = 100;
                    file.outputs = outputs;
                    showToast(`Completed ${file.name}`, 'success');
                } catch (e) {
                    console.error(e);
                    file.status = 'error';
                    showToast(`Error: ${file.name}`, 'error');
                }
                renderFileList();
                if (state.selectedFileId === file.id) renderOutputs(file);
            }

            state.isProcessing = false;
            updateProcessButton();
            processingVideo.src = "";
        };

        btnCancel.onclick = () => {
            if (abortController) abortController.abort();
            state.isProcessing = false;
            updateProcessButton();
            showToast('Batch operation cancelled', 'error');
        };

        function processSingleFile(fileData) {
            return new Promise(async (resolve, reject) => {
                processingVideo.src = fileData.objectUrl;
                processingVideo.playbackRate = fileData.config.playbackRate || 2.0;

                try {
                    await new Promise((r, rej) => {
                        processingVideo.onloadedmetadata = r;
                        processingVideo.onerror = rej;
                    });
                } catch (e) {
                    return reject("Could not load video for processing");
                }

                let bitrate = 2500000;
                if (fileData.config.quality === 'high') bitrate = 8000000;
                if (fileData.config.quality === 'low') bitrate = 1000000;

                let stream;
                if (processingVideo.captureStream) {
                    stream = processingVideo.captureStream();
                } else if (processingVideo.mozCaptureStream) {
                    stream = processingVideo.mozCaptureStream();
                } else {
                    return reject("Browser does not support captureStream");
                }

                if (fileData.config.mute) {
                    stream.getAudioTracks().forEach(t => t.enabled = false);
                } else {
                    try {
                        processingVideo.muted = false;
                        processingVideo.volume = 0;
                    } catch (e) { }
                }

                const mimeType = MediaRecorder.isTypeSupported("video/mp4;codecs=avc1.42E01E,mp4a.40.2")
                    ? "video/mp4;codecs=avc1.42E01E,mp4a.40.2"
                    : "video/webm";

                const ext = mimeType.includes("mp4") ? "mp4" : "webm";

                const recorder = new MediaRecorder(stream, { mimeType, videoBitsPerSecond: bitrate });
                const chunks = [];
                recorder.ondataavailable = e => { if (e.data.size > 0) chunks.push(e.data); };

                // Determine Segments/Regions
                let segments = [];
                const dur = processingVideo.duration;

                if (fileData.config.mode === 'trim') {
                    // Multi-Trim Mode
                    fileData.config.regions.forEach((region, i) => {
                        let end = region.end;
                        if (end <= region.start) end = dur;
                        segments.push({
                            start: region.start,
                            end: end,
                            name: `cut${i + 1}_${fileData.name.split('.')[0]}.${ext}`
                        });
                    });
                } else {
                    // Auto-Segment Mode
                    let t = 0;
                    let i = 1;
                    const segTime = fileData.config.segmentTime;
                    while (t < dur) {
                        segments.push({
                            start: t,
                            end: Math.min(t + segTime, dur),
                            name: `${fileData.name.split('.')[0]}_part${i}.${ext}`
                        });
                        t += segTime;
                        i++;
                    }
                }

                const finalOutputs = [];

                for (let i = 0; i < segments.length; i++) {
                    const seg = segments[i];
                    chunks.length = 0;

                    processingVideo.currentTime = seg.start;
                    await new Promise(r => processingVideo.onseeked = r);

                    recorder.start();
                    try {
                        await processingVideo.play();
                    } catch (e) {
                        processingVideo.muted = true;
                        await processingVideo.play();
                    }

                    await new Promise(r => {
                        const check = () => {
                            const segProgress = (processingVideo.currentTime - seg.start) / (seg.end - seg.start);
                            const totalProgress = ((i + segProgress) / segments.length) * 100;

                            fileData.progress = Math.min(99, totalProgress);
                            const activeEl = Array.from(fileListEl.children).find((c, idx) => state.files[idx].id === fileData.id);
                            if (activeEl) {
                                const statusSpan = activeEl.querySelector('.capitalize.font-medium');
                                if (statusSpan) statusSpan.innerText = `${Math.round(fileData.progress)}%`;
                                const bar = activeEl.querySelector('.absolute.bottom-0');
                                if (!bar && fileData.progress > 1) {
                                    renderFileList();
                                } else if (bar) {
                                    bar.style.width = `${fileData.progress}%`;
                                }
                            }

                            if (processingVideo.currentTime >= seg.end || processingVideo.ended) {
                                processingVideo.pause();
                                recorder.stop();
                                processingVideo.removeEventListener('timeupdate', check);
                                r();
                            }
                        };
                        processingVideo.addEventListener('timeupdate', check);
                    });

                    await new Promise(r => recorder.onstop = r);
                    const blob = new Blob(chunks, { type: mimeType });
                    finalOutputs.push({ name: seg.name, url: URL.createObjectURL(blob) });
                }

                resolve(finalOutputs);
            });
        }

        lucide.createIcons();

    </script>
</body>

</html>